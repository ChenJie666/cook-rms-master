{"remainingRequest":"C:\\Users\\Administrator\\Desktop\\cook-rms-master(1)\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\Administrator\\Desktop\\cook-rms-master(1)\\src\\views\\menu\\MenuDetail.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\Administrator\\Desktop\\cook-rms-master(1)\\src\\views\\menu\\MenuDetail.vue","mtime":1591061914000},{"path":"C:\\Users\\Administrator\\Desktop\\cook-rms-master(1)\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\cook-rms-master(1)\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\cook-rms-master(1)\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\cook-rms-master(1)\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmV4cG9ydCBkZWZhdWx0IHsKICAgIG5hbWU6ICJNZW51RGV0YWlsIiwKICAgIGRhdGEoKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgbWVudUlkOiBudWxsLAogICAgICAgICAgICBmb3JtTWVudToge30sCiAgICAgICAgICAgIGZsMTogW10sCiAgICAgICAgfQogICAgfSwKICAgIGNyZWF0ZWQoKSB7CiAgICAgICAgdGhpcy5nZXRNZW51SWQoKTsKICAgIH0sCiAgICBtb3VudGVkKCkgewogICAgICAgIHRoaXMuZ2V0TWVudURldGFpbCgpOwogICAgfSwKICAgIG1ldGhvZHM6IHsKICAgICAgICBnZXRNZW51SWQoKSB7CiAgICAgICAgICAgIHRoaXMubWVudUlkID0gdGhpcy4kcm91dGUucXVlcnkuaWQ7CiAgICAgICAgfSwKICAgICAgICAvLyDmt7vliqDoj5zosLEKICAgICAgICBhZGRGbExpc3RSb3coKSB7CiAgICAgICAgICAgIHRoaXMuZmwxLnB1c2goewogICAgICAgICAgICAgICAgIm5hbWUiOiAiIiwKICAgICAgICAgICAgICAgICJ3ZWlnaHQiOiAiIiwKICAgICAgICAgICAgfSkKICAgICAgICB9LAogICAgICAgIGFkZENvb2tTdGVwc0xpc3RSb3coKSB7CiAgICAgICAgICAgIHRoaXMuZm9ybU1lbnUuY29va1N0ZXBzLnB1c2goewogICAgICAgICAgICAgICAgInN0ZXBVcmwiOiAiIiwKICAgICAgICAgICAgICAgICJkZXNjcmlwdGlvbiI6ICIiLAogICAgICAgICAgICB9KQogICAgICAgIH0sCiAgICAgICAgZGVsZXRlRmwoaW5kZXgsIHJvd3MpIHsKICAgICAgICAgICAgcm93cy5zcGxpY2UoaW5kZXgsIDEpOwogICAgICAgIH0sCiAgICAgICAgZGVsZXRlQ29va1N0ZXAoaW5kZXgsIHJvd3MpIHsKICAgICAgICAgICAgcm93cy5zcGxpY2UoaW5kZXgsIDEpOwogICAgICAgIH0sCiAgICAgICAgZ2V0TWVudURldGFpbCgpIHsKICAgICAgICAgICAgLy8g5p+l6K+i6I+c6LCx6K+m5oOFCiAgICAgICAgICAgIHRoaXMuJGF4aW9zLmdldCgiL2FwaS9tZW51LWFub24vZ2V0TWVudURldGFpbCIsewogICAgICAgICAgICAgICAgcGFyYW1zOiB7CiAgICAgICAgICAgICAgICAgICAgbWVudUlkOiB0aGlzLm1lbnVJZCwKICAgICAgICAgICAgICAgICAgICB1c2VySWQ6ICcnCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pLnRoZW4ocmVzPT4gewogICAgICAgICAgICAgICAgaWYgKHJlcy5zdGF0dXMgPT09IDIwMCkgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlcy5kYXRhLmRhdGEpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuZm9ybU1lbnUgPSByZXMuZGF0YS5kYXRhOwogICAgICAgICAgICAgICAgICAgIC8vIHRoaXMuZm9ybU1lbnUuZmwgPSBKU09OLnN0cmluZ2lmeSh0aGlzLmZvcm1NZW51LmZsMSk7CiAgICAgICAgICAgICAgICAgICAgbGV0IGpzb25PYmogPSBKU09OLnBhcnNlKHJlcy5kYXRhLmRhdGEuZmwpOwogICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgaW4ganNvbk9iaikgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZsMS5wdXNoKGpzb25PYmpbaV0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLmZsMSA9IEpTT04ucGFyc2UocmVzLmRhdGEuZGF0YS5mbCk7CiAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2cocmVzLmRhdGEuZGF0YSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRoaXMuJGFsZXJ0KCLmn6Xor6Loj5zosLHor6bmg4XlpLHotKUiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICB9LAogICAgICAgIHVwZGF0ZU1lbnVQdWJsaXNoRm9ybSgpIHsKICAgICAgICAgICAgLy8g6I2J56i/54q25oCB5Li6MCBtZW51Rm9ybQogICAgICAgICAgICBjb25zb2xlLmxvZygi5Y+R5biDIikKICAgICAgICAgICAgdGhpcy4kcmVmcy5tZW51Rm9ybS52YWxpZGF0ZSgodmFsaWQpID0+IHsKICAgICAgICAgICAgICAgIGlmICh2YWxpZCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuZm9ybU1lbnUucHVibGlzaFN0YXR1cyA9IDI7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5mb3JtTWVudS5mbCA9IEpTT04uc3RyaW5naWZ5KHRoaXMuZmwxKTsKICAgICAgICAgICAgICAgICAgICAvLyDlr7nosaHovazmiJBqc29u5a+56LGhCiAgICAgICAgICAgICAgICAgICAgbGV0IGZvcm1EYXRhID0gSlNPTi5zdHJpbmdpZnkodGhpcy5mb3JtTWVudSk7CiAgICAgICAgICAgICAgICAgICAgbGV0IGNvbmZpZyA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyczogeyJDb250ZW50LVR5cGUiOiAiYXBwbGljYXRpb24vanNvbjtjaGFyc2V0PVVURi04In0KICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGxldCB1cmwgPSAiL2FwaS9tZW51L3VwZGF0ZU1lbnUiOwogICAgICAgICAgICAgICAgICAgIHRoaXMuJGF4aW9zLnBvc3QodXJsLCBmb3JtRGF0YSwgY29uZmlnKS50aGVuKHJlcyA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMuc3RhdHVzID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJG1lc3NhZ2Uuc3VjY2Vzcygi57yW6L6R5oiQ5YqfIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyDpmLLmraLooajljZXorrDlvZXkuIrmrKHorrDlvZUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZm9ybU1lbnU9e2JyYW5kX3JpZ2h0OjB9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g5re75Yqg5oiQ5Yqf6Lez6L2s5Yiw6I+c6LCx6aG16Z2iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRyb3V0ZXIucHVzaCh7cGF0aDoiL21lbnUifSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnZXJyb3Igc3VibWl0ISEnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKCiAgICAgICAgfSwKICAgICAgICB1cGRhdGVNZW51Rm9ybSgpewogICAgICAgICAgICAvLyDkuIrmnrbnirbmgIHkuLoxCiAgICAgICAgICAgIGNvbnNvbGUubG9nKCLkuIrmnrYiKTsKICAgICAgICAgICAgdGhpcy4kcmVmcy5tZW51Rm9ybS52YWxpZGF0ZSgodmFsaWQpID0+IHsKICAgICAgICAgICAgICAgIGlmICh2YWxpZCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuZm9ybU1lbnUucHVibGlzaFN0YXR1cyA9IDE7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5mb3JtTWVudS5mbCA9IEpTT04uc3RyaW5naWZ5KHRoaXMuZmwxKTsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyh2YWxpZCk7CiAgICAgICAgICAgICAgICAgICAgLy8g5a+56LGh6L2s5oiQanNvbuWvueixoQogICAgICAgICAgICAgICAgICAgIGxldCBmb3JtRGF0YSA9IEpTT04uc3RyaW5naWZ5KHRoaXMuZm9ybU1lbnUpOwogICAgICAgICAgICAgICAgICAgIGxldCBjb25maWcgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsiQ29udGVudC1UeXBlIjogImFwcGxpY2F0aW9uL2pzb247Y2hhcnNldD1VVEYtOCJ9CiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBsZXQgdXJsID0gIi9hcGkvbWVudS91cGRhdGVNZW51IjsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRheGlvcy5wb3N0KHVybCwgZm9ybURhdGEsIGNvbmZpZykudGhlbihyZXMgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzLnN0YXR1cyA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRtZXNzYWdlLnN1Y2Nlc3MoIue8lui+keaIkOWKnyIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g6Ziy5q2i6KGo5Y2V6K6w5b2V5LiK5qyh6K6w5b2VCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZvcm1NZW51PXticmFuZF9yaWdodDowfTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIOa3u+WKoOaIkOWKn+i3s+i9rOWIsOiPnOiwsemhtemdogogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kcm91dGVyLnB1c2goe3BhdGg6Ii9tZW51In0pOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2Vycm9yIHN1Ym1pdCEhJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CgogICAgICAgIH0sCgoKICAgIH0KCn0K"},{"version":3,"sources":["MenuDetail.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;AAGA;;AAEA","file":"MenuDetail.vue","sourceRoot":"src/views/menu","sourcesContent":["<template>\n  <el-card class=\"box-card\">\n  <el-form ref=\"menuForm\" :model=\"formMenu\" >\n    <el-form-item label=\"菜谱名称:\" label-width=\"100px\">\n      <el-input v-model=\"formMenu.name\" placeholder=\"请输入菜谱名称\" style=\"width:200px\"></el-input>\n    </el-form-item>\n    <el-form-item label=\"菜谱难度:\" label-width=\"100px\">\n      <el-select v-model=\"formMenu.deg\" placeholder=\"请选择菜谱难度\">\n        <el-option label=\"1\" value=\"1\"></el-option>\n        <el-option label=\"2\" value=\"2\"></el-option>\n        <el-option label=\"3\" value=\"3\"></el-option>\n        <el-option label=\"4\" value=\"4\"></el-option>\n        <el-option label=\"5\" value=\"5\"></el-option>\n      </el-select>\n    </el-form-item>\n    <el-form-item label=\"预计用时:\" label-width=\"100px\" style=\"width:200px\">\n      <el-input v-model=\"formMenu.tm\" ></el-input>\n    </el-form-item>\n    <el-form-item label=\"菜谱头图:\" label-width=\"100px\" style=\"width:200px\">\n      <el-input v-model=\"formMenu.menuUrl\" ></el-input>\n    </el-form-item>\n    <!--      table表格形式可以实现表格的增加一行-->\n    <el-form-item label=\"食材清单:\" label-width=\"100px\">\n      <el-table\n              border\n              :data=\"fl1\"\n              style=\"width: 50%\">\n        <el-table-column fixed=\"left\"  label=\"食材名称\" min-width=\"30\">\n          <template slot-scope=\"scope\">\n            <el-input v-model=\"scope.row.name\"></el-input>\n          </template>\n        </el-table-column>\n        <el-table-column  label=\"分量\" min-width=\"20\">\n          <template slot-scope=\"scope\">\n            <el-input v-model=\"scope.row.weight\"></el-input>\n          </template>\n        </el-table-column>\n        <el-table-column\n                fixed=\"right\"\n                label=\"操作\"\n                width=\"120\">\n          <template slot-scope=\"scope\">\n            <el-button\n                    @click.native.prevent=\"deleteFl(scope.$index, formMenu.fl)\"\n                    type=\"text\"\n                    size=\"small\">\n              移除\n            </el-button>\n          </template>\n        </el-table-column>\n      </el-table>\n      <el-button type=\"success\" @click=\"addFlListRow()\" round>添加一行</el-button>\n    </el-form-item>\n    <el-form-item label-width=\"100px\">\n      <el-input v-model=\"formMenu.fl\" type=\"hidden\"></el-input>\n    </el-form-item>\n    <el-form-item label=\"图文步骤:\" label-width=\"100px\">\n      <el-table\n              border\n              :data=\"formMenu.cookSteps\"\n              style=\"width: 70%\">\n        <el-table-column fixed=\"left\"  label=\"图片url\" min-width=\"20\">\n          <template slot-scope=\"scope\">\n            <el-input v-model=\"scope.row.stepUrl\"></el-input>\n          </template>\n        </el-table-column>\n        <el-table-column  label=\"图片说明\" min-width=\"40\">\n          <template slot-scope=\"scope\">\n            <el-input v-model=\"scope.row.description\"></el-input>\n          </template>\n        </el-table-column>\n        <el-table-column\n                fixed=\"right\"\n                label=\"操作\"\n                min-width=\"10\">\n          <template slot-scope=\"scope\">\n            <el-button\n                    @click.native.prevent=\"deleteCookStep(scope.$index, formMenu.cookSteps)\"\n                    type=\"text\"\n                    size=\"small\">\n              移除\n            </el-button>\n          </template>\n        </el-table-column>\n      </el-table>\n      <el-button type=\"success\" @click=\"addCookStepsListRow()\" round>添加一行</el-button>\n    </el-form-item>\n    <el-form-item label=\"小贴士:\" label-width=\"100px\">\n      <el-input v-model=\"formMenu.tip\"\n                placeholder=\"请输入小贴士\"\n                style=\"width:300px\"\n                type=\"textarea\"\n                maxlength=\"200\"\n                show-word-limit\n                clearable\n      ></el-input>\n    </el-form-item>\n    <el-form-item label-width=\"100px\">\n      <el-checkbox v-model=\"formMenu.isOfficial\">是否发布为官方菜谱</el-checkbox>\n    </el-form-item>\n    <el-form-item label-width=\"100px\">\n      <el-button type=\"primary\" @click=\"updateMenuPublishForm()\">发布</el-button>\n      <el-button type=\"primary\" @click=\"updateMenuForm()\">上传</el-button>\n    </el-form-item>\n  </el-form>\n  </el-card>\n</template>\n\n<script>\n    export default {\n        name: \"MenuDetail\",\n        data() {\n            return {\n                menuId: null,\n                formMenu: {},\n                fl1: [],\n            }\n        },\n        created() {\n            this.getMenuId();\n        },\n        mounted() {\n            this.getMenuDetail();\n        },\n        methods: {\n            getMenuId() {\n                this.menuId = this.$route.query.id;\n            },\n            // 添加菜谱\n            addFlListRow() {\n                this.fl1.push({\n                    \"name\": \"\",\n                    \"weight\": \"\",\n                })\n            },\n            addCookStepsListRow() {\n                this.formMenu.cookSteps.push({\n                    \"stepUrl\": \"\",\n                    \"description\": \"\",\n                })\n            },\n            deleteFl(index, rows) {\n                rows.splice(index, 1);\n            },\n            deleteCookStep(index, rows) {\n                rows.splice(index, 1);\n            },\n            getMenuDetail() {\n                // 查询菜谱详情\n                this.$axios.get(\"/api/menu-anon/getMenuDetail\",{\n                    params: {\n                        menuId: this.menuId,\n                        userId: ''\n                    }\n                }).then(res=> {\n                    if (res.status === 200) {\n                        console.log(res.data.data);\n                        this.formMenu = res.data.data;\n                        // this.formMenu.fl = JSON.stringify(this.formMenu.fl1);\n                        let jsonObj = JSON.parse(res.data.data.fl);\n                        for (let i in jsonObj) {\n                            this.fl1.push(jsonObj[i]);\n                        }\n                        // this.fl1 = JSON.parse(res.data.data.fl);\n                        // console.log(res.data.data);\n                    } else {\n                        this.$alert(\"查询菜谱详情失败\");\n                    }\n                })\n            },\n            updateMenuPublishForm() {\n                // 草稿状态为0 menuForm\n                console.log(\"发布\")\n                this.$refs.menuForm.validate((valid) => {\n                    if (valid) {\n                        this.formMenu.publishStatus = 2;\n                        this.formMenu.fl = JSON.stringify(this.fl1);\n                        // 对象转成json对象\n                        let formData = JSON.stringify(this.formMenu);\n                        let config = {\n                            headers: {\"Content-Type\": \"application/json;charset=UTF-8\"}\n                        };\n                        let url = \"/api/menu/updateMenu\";\n                        this.$axios.post(url, formData, config).then(res => {\n                            if (res.status === 200) {\n                                this.$message.success(\"编辑成功\");\n                                // 防止表单记录上次记录\n                                this.formMenu={brand_right:0};\n                                // 添加成功跳转到菜谱页面\n                                this.$router.push({path:\"/menu\"});\n                            } else {\n                                console.log('error submit!!');\n                                return false;\n                            }\n                        });\n                    }\n                });\n\n            },\n            updateMenuForm(){\n                // 上架状态为1\n                console.log(\"上架\");\n                this.$refs.menuForm.validate((valid) => {\n                    if (valid) {\n                        this.formMenu.publishStatus = 1;\n                        this.formMenu.fl = JSON.stringify(this.fl1);\n                        console.log(valid);\n                        // 对象转成json对象\n                        let formData = JSON.stringify(this.formMenu);\n                        let config = {\n                            headers: {\"Content-Type\": \"application/json;charset=UTF-8\"}\n                        };\n                        let url = \"/api/menu/updateMenu\";\n                        this.$axios.post(url, formData, config).then(res => {\n                            if (res.status === 200) {\n                                this.$message.success(\"编辑成功\");\n                                // 防止表单记录上次记录\n                                this.formMenu={brand_right:0};\n                                // 添加成功跳转到菜谱页面\n                                this.$router.push({path:\"/menu\"});\n                            } else {\n                                console.log('error submit!!');\n                                return false;\n                            }\n                        });\n                    }\n                });\n\n            },\n\n\n        }\n\n    }\n</script>\n\n<style scoped>\n\n</style>\n"]}]}