(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-dfad04f6"],{"0d64":function(e,t,s){"use strict";var a=s("cbca"),l=s.n(a);l.a},4959:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"FestivalList"},[s("el-breadcrumb",{attrs:{separator:"/"}},[s("el-breadcrumb-item",[s("i",{staticClass:"el-icon-cloudy"}),e._v(" 应用云")]),s("el-breadcrumb-item",[s("i",{staticClass:"el-icon-printer"}),e._v(" 短消息列表")])],1),s("div",{staticClass:"container"},[s("el-button",{attrs:{type:"primary"},on:{click:function(t){e.dialogFormVisible=!0}}},[e._v("添加短消息记录")]),s("el-dialog",{attrs:{title:e.getTitle,visible:e.dialogFormVisible,width:"600px"},on:{"update:visible":function(t){e.dialogFormVisible=t},close:e.resetObj}},[s("el-form",{ref:"form",attrs:{model:e.shortMessageVO}},[s("el-form-item",{attrs:{label:"起止时间","label-width":"100px"}},[s("el-date-picker",{attrs:{type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",align:"left","default-time":["00:00:00","00:00:00"],"value-format":"timestamp"},model:{value:e.datetimerange,callback:function(t){e.datetimerange=t},expression:"datetimerange"}})],1),s("el-form-item",{attrs:{label:"设备型号",prop:"region","label-width":"100px"}},[s("el-select",{attrs:{placeholder:"请选择设备型号"},model:{value:e.shortMessageVO.deviceModel,callback:function(t){e.$set(e.shortMessageVO,"deviceModel",t)},expression:"shortMessageVO.deviceModel"}},[s("el-option",{attrs:{label:"Q6",value:"Q6"}})],1)],1),s("el-form-item",{attrs:{label:"消息类型",prop:"region","label-width":"100px"}},[s("el-select",{attrs:{placeholder:"请选择消息类型"},model:{value:e.shortMessageVO.type,callback:function(t){e.$set(e.shortMessageVO,"type",t)},expression:"shortMessageVO.type"}},[s("el-option",{attrs:{label:"文字",value:"1"}}),s("el-option",{attrs:{label:"图片",value:"2"}})],1)],1),1==e.shortMessageVO.type?s("el-form-item",{attrs:{label:"文本消息内容",prop:"desc","label-width":"100px"}},[s("el-input",{attrs:{type:"textarea",placeholder:"请输入文本消息内容"},model:{value:e.shortMessageVO.content,callback:function(t){e.$set(e.shortMessageVO,"content",t)},expression:"shortMessageVO.content"}})],1):e._e(),2==e.shortMessageVO.type?s("el-form-item",{attrs:{label:"上传图片","label-width":"100px"}},[s("el-upload",{attrs:{action:"/cloud/application/upload","list-type":"picture-card","on-preview":e.handlePictureCardPreview,"on-remove":e.handleRemove,"on-success":e.handleSuccess}},[s("i",{staticClass:"el-icon-plus"})]),s("el-dialog",{attrs:{visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[s("img",{attrs:{width:"100%",src:e.fileVO.url,alt:""}})])],1):e._e(),""!==e.fileVO.url&&2==e.shortMessageVO.type?s("el-form-item",{attrs:{label:"图片名称","label-width":"100px"}},[s("el-input",{attrs:{type:"textarea",disabled:!0},model:{value:e.getNameByUrl,callback:function(t){e.getNameByUrl=t},expression:"getNameByUrl"}})],1):e._e(),""!==e.fileVO.url&&2==e.shortMessageVO.type?s("el-form-item",{attrs:{label:"图片地址","label-width":"100px"}},[s("el-input",{attrs:{type:"textarea",disabled:!0},model:{value:e.fileVO.url,callback:function(t){e.$set(e.fileVO,"url",t)},expression:"fileVO.url"}})],1):e._e()],1),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:e.cancelOperation}},[e._v("取 消")]),s("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.addOrUpdate()}}},[e._v("确 定")])],1)],1),s("div",{staticStyle:{margin:"20px"}}),s("el-table",{staticStyle:{width:"100%"},attrs:{data:e.records,"header-cell-style":{background:"#F6F7FB"},border:""}},[s("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-form",{staticClass:"demo-table-expand",attrs:{"label-position":"right","label-width":"150px",inline:""}},[s("el-form-item",{attrs:{label:"id"}},[s("span",[e._v(e._s(t.row.id))])]),s("el-form-item",{attrs:{label:"消息类型"}},[s("span",[e._v(e._s(t.row.type))])]),s("el-form-item",{attrs:{label:"文本消息内容"}},[s("span",[e._v(e._s(t.row.content))])]),s("el-form-item",{attrs:{label:"图片地址"}},[s("el-link",{attrs:{target:"_blank",type:"primary",href:t.row.imageUrl}},[e._v(" "+e._s(t.row.imageUrl)+" ")])],1),s("el-form-item",{attrs:{label:"开始时间时间戳"}},[s("span",[e._v(e._s(t.row.startTime))])]),s("el-form-item",{attrs:{label:"结束时间时间戳"}},[s("span",[e._v(e._s(t.row.endTime))])]),s("el-form-item",{attrs:{label:"设备型号"}},[s("span",[e._v(e._s(t.row.deviceModel))])]),s("el-form-item",{attrs:{label:"创建时间"}},[s("span",[e._v(e._s(t.row.createTime))])])],1)]}}])}),s("el-table-column",{attrs:{align:"center",label:"序号",fixed:"",prop:"index",width:"70px"}}),s("el-table-column",{attrs:{align:"center",label:"消息类型",prop:"typeName",width:"100px"}}),s("el-table-column",{attrs:{align:"center",label:"内容",prop:"exp",width:"150px"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("div",{staticStyle:{color:"deepskyblue"},attrs:{align:"center"}},[e._v(e._s(t.row.content))]),s("el-image",{staticStyle:{width:"80%",height:"30%"},attrs:{src:t.row.imageUrl,"preview-src-list":[t.row.imageUrl],fit:"contain",lazy:""}},[""===t.row.imageUrl?s("div",{staticClass:"image-slot",attrs:{slot:"error"},slot:"error"}):e._e()])]}}])}),s("el-table-column",{attrs:{align:"center",label:"开始时间",prop:"startDatetime"}}),s("el-table-column",{attrs:{align:"center",label:"结束时间",prop:"endDatetime"}}),s("el-table-column",{attrs:{align:"center",label:"设备型号",prop:"deviceModel"}}),s("el-table-column",{attrs:{align:"center",label:"创建时间",prop:"createTime"}}),s("el-table-column",{attrs:{align:"center",fixed:"right",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{attrs:{type:"text",icon:"el-icon-edit"},on:{click:function(s){return e.setObj(t.row.id)}}},[e._v("编辑")]),s("el-button",{staticStyle:{color:"red"},attrs:{type:"text",icon:"el-icon-delete"},on:{click:function(s){return e.deleteById(t.row.id)}}},[e._v("删除 ")])]}}])})],1),s("br"),s("el-pagination",{attrs:{"current-page":e.pageCurrent,"page-sizes":[10,20,50,100],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1)},l=[],i=(s("4de4"),s("baa5"),s("d81d"),s("fb6a"),s("b0c0"),s("99af"),s("b775")),r={getShortMessageList:function(e,t){return Object(i["a"])({url:"/application/message/alllist/".concat(e,"/").concat(t),method:"get"})},addShortMessage:function(e){return Object(i["a"])({url:"application/message/add",method:"post",data:e})},updateShortMessage:function(e){return Object(i["a"])({url:"application/message/update",method:"post",data:e})},deleteShortMessage:function(e){return Object(i["a"])({url:"/application/message/delete/".concat(e),method:"delete"})}},o=s("c1df"),n=s.n(o),c={name:"FestivalList",components:{},data:function(){return{total:0,pages:0,records:[],pageCurrent:1,pageSize:10,shortMessageVO:{id:null,type:null,content:"",imageUrl:"",startTime:null,endTime:null,deviceModel:null},dialogFormVisible:!1,dialogVisible:!1,fileVO:{url:"",md5:"",size:null},datetimerange:[]}},created:function(){this.getShortMessageList(1)},methods:{getShortMessageList:function(e){var t=this;this.pageCurrent=e,r.getShortMessageList(this.pageCurrent,this.pageSize).then((function(e){console.log(e);var s=e.data;t.total=s.total,t.pages=s.pages,t.records=s.records,t.pageCurrent=s.current,t.pageSize=s.size})).catch((function(e){console.log(e)}))},addOrUpdate:function(){null==this.shortMessageVO.id?this.addShortMessage():this.updateShortMessage()},cancelOperation:function(){this.dialogFormVisible=!1,this.resetObj()},setObj:function(e){console.log(e);var t=this.records.filter((function(t){return t.id===e})),s=t.pop();this.shortMessageVO.id=s.id,this.shortMessageVO.type=s.type+"",this.shortMessageVO.content=s.content,this.shortMessageVO.imageUrl=s.imageUrl,this.fileVO.url=s.imageUrl,this.shortMessageVO.startTime=s.startTime,this.shortMessageVO.endTime=s.endTime,this.shortMessageVO.deviceModel=s.deviceModel,this.datetimerange=[1e3*s.startTime,1e3*s.endTime],this.dialogFormVisible=!0},resetObj:function(){this.shortMessageVO={id:null,type:null,content:"",imageUrl:"",startTime:null,endTime:null,deviceModel:null},this.fileVO={url:"",md5:"",size:null},this.datetimerange=[]},addShortMessage:function(){var e=this,t=this.datetimerange.pop()/1e3,s=this.datetimerange.pop()/1e3;console.log(s+"-"+t),console.log("*****shortMessageVO.type:"+this.shortMessageVO.type),1==this.shortMessageVO.type?(this.shortMessageVO.imageUrl="",console.log("插入类型为文字")):2==this.shortMessageVO.type&&(this.shortMessageVO.content="",this.shortMessageVO.imageUrl=this.fileVO.url,console.log("插入类型为图片"),console.log("***fileVO.url"+this.fileVO.url),console.log("***shortMessageVO.imageUrl"+this.shortMessageVO.imageUrl)),this.shortMessageVO.startTime=s,this.shortMessageVO.endTime=t,console.log("***addShortMessage:"+this.shortMessageVO),r.addShortMessage(this.shortMessageVO).then((function(t){e.getShortMessageList(e.pageCurrent),e.$message({type:"success",message:"添加成功!"}),e.dialogFormVisible=!1,e.dialogVisible=!1,e.resetObj()})).catch((function(e){console.log(e)}))},updateShortMessage:function(){var e=this,t=this.datetimerange.pop()/1e3,s=this.datetimerange.pop()/1e3;console.log(s+"-"+t),1==this.shortMessageVO.type?this.shortMessageVO.imageUrl="":2==this.shortMessageVO.type&&(this.shortMessageVO.content="",this.shortMessageVO.imageUrl=this.fileVO.url,console.log("***fileVO.url"+this.fileVO.url),console.log("***shortMessageVO.imageUrl"+this.shortMessageVO.imageUrl)),this.shortMessageVO.startTime=s,this.shortMessageVO.endTime=t,console.log("***addShortMessage:"+this.shortMessageVO),r.updateShortMessage(this.shortMessageVO).then((function(t){e.getShortMessageList(e.pageCurrent),e.$message({type:"success",message:"修改成功!"}),e.dialogFormVisible=!1,e.dialogVisible=!1,e.resetObj()})).catch((function(e){console.log(e)}))},deleteById:function(e){var t=this;this.$confirm("确认删除该记录？","提示",{confirmButtonClass:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){r.deleteShortMessage(e).then((function(e){t.getShortMessageList(t.pageCurrent),console.log(e),t.$message({type:"success",message:"删除成功!"})})).catch((function(e){console.log(e)}))})).catch((function(e){console.log(e)}))},handleSizeChange:function(e){this.pageSize=e,this.getShortMessageList(this.pageCurrent)},handleCurrentChange:function(e){this.pageCurrent=e,this.getShortMessageList(this.pageCurrent)},handleRemove:function(e,t){console.log("handleRemove"+e,t),this.fileVO={url:"",md5:"",size:null}},handlePictureCardPreview:function(e){console.log("***handlePictureCardPreview:"+e)},handleSuccess:function(e,t,s){var a=e.data;this.fileVO.url=a.url,console.log("****fileVO.url:"+this.fileVO.url),this.fileVO.md5=a.md5,this.fileVO.size=a.size,this.dialogVisible=!1},srcList:function(e){var t=this.records.map((function(e){return e.imageUrl})),s=t.slice(0,e),a=t.slice(e);return a.push(s)}},computed:{getTitle:function(){return null==this.shortMessageVO.id?"添加短消息记录":"修改短消息记录"},getNameByUrl:function(){if(""!==this.fileVO.url)return this.fileVO.url.slice(this.fileVO.url.lastIndexOf("/")+34);console.log("getNameByUrl中的URL为空")}},watch:{records:function(){var e=this,t=0;this.records.map((function(s){s.index=(e.pageCurrent-1)*e.pageSize+ ++t,s.startDatetime=n()(1e3*s.startTime).format("YYYY-MM-DD HH:mm:ss"),s.endDatetime=n()(1e3*s.endTime).format("YYYY-MM-DD HH:mm:ss"),s.typeName=1===s.type?"文字":"图片",null!=s.imageUrl&&s.imageUrl.length>33&&(s.name=s.imageUrl.slice(s.imageUrl.lastIndexOf("/")+34))}))}}},d=c,g=(s("0d64"),s("2877")),u=Object(g["a"])(d,a,l,!1,null,"51021f44",null);t["default"]=u.exports},a640:function(e,t,s){"use strict";var a=s("d039");e.exports=function(e,t){var s=[][e];return!!s&&a((function(){s.call(null,t||function(){throw 1},1)}))}},baa5:function(e,t,s){var a=s("23e7"),l=s("e58c");a({target:"Array",proto:!0,forced:l!==[].lastIndexOf},{lastIndexOf:l})},cbca:function(e,t,s){},d81d:function(e,t,s){"use strict";var a=s("23e7"),l=s("b727").map,i=s("1dde"),r=s("ae40"),o=i("map"),n=r("map");a({target:"Array",proto:!0,forced:!o||!n},{map:function(e){return l(this,e,arguments.length>1?arguments[1]:void 0)}})},e58c:function(e,t,s){"use strict";var a=s("fc6a"),l=s("a691"),i=s("50c4"),r=s("a640"),o=s("ae40"),n=Math.min,c=[].lastIndexOf,d=!!c&&1/[1].lastIndexOf(1,-0)<0,g=r("lastIndexOf"),u=o("indexOf",{ACCESSORS:!0,1:0}),h=d||!g||!u;e.exports=h?function(e){if(d)return c.apply(this,arguments)||0;var t=a(this),s=i(t.length),r=s-1;for(arguments.length>1&&(r=n(r,l(arguments[1]))),r<0&&(r=s+r);r>=0;r--)if(r in t&&t[r]===e)return r||0;return-1}:c},fb6a:function(e,t,s){"use strict";var a=s("23e7"),l=s("861d"),i=s("e8b5"),r=s("23cb"),o=s("50c4"),n=s("fc6a"),c=s("8418"),d=s("b622"),g=s("1dde"),u=s("ae40"),h=g("slice"),p=u("slice",{ACCESSORS:!0,0:0,1:2}),m=d("species"),f=[].slice,b=Math.max;a({target:"Array",proto:!0,forced:!h||!p},{slice:function(e,t){var s,a,d,g=n(this),u=o(g.length),h=r(e,u),p=r(void 0===t?u:t,u);if(i(g)&&(s=g.constructor,"function"!=typeof s||s!==Array&&!i(s.prototype)?l(s)&&(s=s[m],null===s&&(s=void 0)):s=void 0,s===Array||void 0===s))return f.call(g,h,p);for(a=new(void 0===s?Array:s)(b(p-h,0)),d=0;h<p;h++,d++)h in g&&c(a,d,g[h]);return a.length=d,a}})}}]);
//# sourceMappingURL=chunk-dfad04f6.6a72b9fb.js.map